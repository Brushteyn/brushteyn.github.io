(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{475:function(t,e,o){},538:function(t,e,o){"use strict";o(475)},593:function(t,e,o){"use strict";o.r(e);var r=o(2),n=(o(19),{name:"TYandexMap",props:{coordinates:{type:Array,default:()=>[]},markIcon:{type:String,default:""}},data:()=>({map:void 0,route:void 0,userCoords:[]}),watch:{coordinates(t){this.removePlot(),this.updateMarkers(t)}},mounted(){window.ymaps&&this.$nextTick((()=>{window.ymaps.ready(this.initMap)}))},methods:{initMap(){this.map=new window.ymaps.Map(this.$refs.mapEl,{center:this.coordinates,zoom:15,controls:[]},{suppressMapOpenBlock:!0}),this.mapControls(),this.updateMarkers(this.coordinates)},mapControls(){var t,e=this,o=window.ymaps.templateLayoutFactory.createClass('<div class="ymaps-controls"></div>',{build(){o.superclass.build.call(this),this.locationEl=document.querySelector(".button.contact__btn._contacts"),this.locationEl.addEventListener("click",this.getLocation)},clear(){this.locationEl&&this.locationEl.removeEventListener("click",this.getLocation),o.superclass.clear.call(this)},getLocation:(t=Object(r.a)((function*(){yield e.plotRoute()})),function(){return t.apply(this,arguments)})}),n=new window.ymaps.control.Button({options:{layout:o}});this.map.controls.add(n)},placemark:t=>new window.ymaps.Placemark(t,{},{iconLayout:"default#image",iconImageHref:"/svg/map_logo.svg",iconImageSize:[100,108],iconImageOffset:[-50,-108]}),removePlot(){this.route&&this.map.geoObjects.remove(this.route),this.route=null,this.map.geoObjects.each((marker=>{marker.properties.set("plot",!1)}))},plotRoute(){var t=this;return Object(r.a)((function*(){t.route?t.removePlot():(yield t.getUserPosition(),t.route=new window.ymaps.multiRouter.MultiRoute({referencePoints:[t.userCoords,t.coordinates],params:{results:1}},{wayPointVisible:!1,boundsAutoApply:!0,routeActiveStrokeColor:"004D47"}),t.map.geoObjects.add(t.route),t.route.events.once("update",(()=>{console.log(t.map.geoObjects),t.map.geoObjects.each((marker=>{marker.properties.set("plot",!0)}))})))}))()},getUserPosition(){return new Promise(((t,e)=>{if(this.userCoords.length)return t(this.userCoords);window.ymaps.geolocation.get({provider:"browser"}).then((e=>(this.userCoords=e.geoObjects.get(0).geometry._coordinates,t(this.userCoords)))).catch((e=>{window.ymaps.geolocation.get({provider:"yandex"}).then((e=>(this.userCoords=e.geoObjects.get(0).geometry._coordinates,t(this.userCoords)))).catch((t=>console.error("Не могу определить ваше местоположение.")))}))}))},updateMarkers(t){this.map.geoObjects.removeAll(),this.map.geoObjects.add(this.placemark(t))}}}),c=n,l=(o(538),o(31)),component=Object(l.a)(c,(function(){return(0,this._self._c)("div",{ref:"mapEl",staticClass:"map"},[this._t("default")],2)}),[],!1,null,null,null);e.default=component.exports}}]);